<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Debug Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
            line-height: 1.6;
        }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            background: #16213e;
            color: #0ff;
            border: 1px solid #0ff;
            border-radius: 4px;
        }
        button:hover {
            background: #0f1419;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: #16213e;
            border-radius: 8px;
            border: 1px solid #0ff;
        }
        .value {
            color: #0f0;
        }
        .missing {
            color: #f00;
        }
        h2 {
            color: #0ff;
        }
        pre {
            background: #0f1419;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîç CareDroid Auth Debug Test</h1>
    
    <div class="section">
        <h2>Current localStorage Status</h2>
        <div id="localStorageStatus"></div>
        <button onclick="refreshStatus()">üîÑ Refresh Status</button>
    </div>
    
    <div class="section">
        <h2>Test Actions</h2>
        <button onclick="createMockAuth()">‚úÖ Create Mock Auth Data</button>
        <button onclick="clearAuth()">üóëÔ∏è Clear All Auth Data</button>
        <button onclick="testNavigation()">üöÄ Test Navigation to /</button>
    </div>
    
    <div class="section">
        <h2>Debug Log</h2>
        <pre id="debugLog"></pre>
    </div>

    <script>
        const log = (message) => {
            const logEl = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        };

        const refreshStatus = () => {
            const token = localStorage.getItem('caredroid_access_token');
            const profile = localStorage.getItem('caredroid_user_profile');
            
            let html = '<p><strong>Token:</strong> ';
            if (token) {
                html += `<span class="value">‚úÖ Present (${token})</span>`;
            } else {
                html += '<span class="missing">‚ùå Missing</span>';
            }
            html += '</p>';
            
            html += '<p><strong>Profile:</strong> ';
            if (profile) {
                html += '<span class="value">‚úÖ Present</span>';
                try {
                    const parsed = JSON.parse(profile);
                    html += `<pre>${JSON.stringify(parsed, null, 2)}</pre>`;
                } catch (e) {
                    html += '<span class="missing">‚ùå Parse Error</span>';
                }
            } else {
                html += '<span class="missing">‚ùå Missing</span>';
            }
            html += '</p>';
            
            document.getElementById('localStorageStatus').innerHTML = html;
            log('Status refreshed');
        };

        const createMockAuth = () => {
            const mockUser = {
                id: 'dev-user',
                email: 'dev@caredroid.local',
                name: 'Development User',
                role: 'admin',
                fullName: 'Development User',
                isEmailVerified: true,
                twoFactorEnabled: false,
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('caredroid_access_token', 'dev-bypass-token');
            localStorage.setItem('caredroid_user_profile', JSON.stringify(mockUser));
            
            log('‚úÖ Mock auth data created');
            log(`Token: dev-bypass-token`);
            log(`Profile: ${JSON.stringify(mockUser, null, 2)}`);
            refreshStatus();
        };

        const clearAuth = () => {
            localStorage.removeItem('caredroid_access_token');
            localStorage.removeItem('caredroid_user_profile');
            log('üóëÔ∏è Auth data cleared');
            refreshStatus();
        };

        const testNavigation = () => {
            log('üöÄ Testing navigation to /');
            log('Current URL: ' + window.location.href);
            log('Token: ' + (localStorage.getItem('caredroid_access_token') ? '‚úÖ' : '‚ùå'));
            log('Profile: ' + (localStorage.getItem('caredroid_user_profile') ? '‚úÖ' : '‚ùå'));
            
            setTimeout(() => {
                log('Navigating...');
                window.location.href = '/';
            }, 1000);
        };

        // Auto-refresh on load
        refreshStatus();
        log('Auth Debug Test loaded');
    </script>
</body>
</html>
