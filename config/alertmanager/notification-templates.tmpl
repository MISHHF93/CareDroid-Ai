{{ define "slack.default.title" -}}
[{{ .Status | toUpper }}] {{ .GroupLabels.alertname }}
{{- end }}

{{ define "slack.default.text" -}}
{{ range .Alerts.Firing -}}
*Alert:* {{ .Labels.alertname }}
*Severity:* {{ .Labels.severity }}
{{ if .Annotations.summary -}}
*Summary:* {{ .Annotations.summary }}
{{ end -}}
{{ if .Annotations.description -}}
*Description:* {{ .Annotations.description }}
{{ end -}}
{{ if .Labels.endpoint -}}
*Endpoint:* {{ .Labels.endpoint }}
{{ end -}}
{{ if .Labels.instance -}}
*Instance:* {{ .Labels.instance }}
{{ end -}}
*Fired:* {{ .StartsAt.Format "2006-01-02 15:04:05" }}
{{ end -}}
{{ if .Alerts.Resolved -}}
*Resolved Alerts:* {{ len .Alerts.Resolved }}
{{ range .Alerts.Resolved -}}
  â€¢ {{ .Labels.alertname }} (resolved at {{ .EndsAt.Format "2006-01-02 15:04:05" }})
{{ end -}}
{{ end -}}
{{- end }}

{{ define "email.default.subject" -}}
[{{ .Status | toUpper }}] CareDroid Alert: {{ .GroupLabels.alertname }}
{{- end }}

{{ define "email.default.html" -}}
<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: Arial, sans-serif; color: #333; }
    .alert-header { background: #f5f5f5; padding: 10px; margin-bottom: 10px; border-left: 4px solid #d9534f; }
    .critical { border-left-color: #d9534f; } /* Red */
    .warning { border-left-color: #f0ad4e; } /* Orange */
    .info { border-left-color: #5bc0de; } /* Blue */
    .resolved { border-left-color: #5cb85c; } /* Green */
    .alert-body { margin: 20px 0; padding: 10px; background: #fafafa; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; }
    th { background: #f2f2f2; padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
    td { padding: 8px; border-bottom: 1px solid #ddd; }
    .footer { margin-top: 20px; padding-top: 10px; border-top: 1px solid #ddd; font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <div class="alert-header {{ .Status | toLower }}">
    <h2>{{ .GroupLabels.alertname }}</h2>
    <p><strong>Status:</strong> {{ .Status | toUpper }} | <strong>Severity:</strong> {{ .GroupLabels.severity | toUpper }}</p>
  </div>

  {{ if .Alerts.Firing }}
  <div class="alert-body">
    <h3>Firing Alerts ({{ len .Alerts.Firing }})</h3>
    <table>
      <thead>
        <tr>
          <th>Alert Name</th>
          <th>Severity</th>
          <th>Summary</th>
          <th>Fired At</th>
        </tr>
      </thead>
      <tbody>
        {{ range .Alerts.Firing }}
        <tr>
          <td><strong>{{ .Labels.alertname }}</strong></td>
          <td>{{ .Labels.severity }}</td>
          <td>{{ .Annotations.summary }}</td>
          <td>{{ .StartsAt.Format "2006-01-02 15:04:05" }}</td>
        </tr>
        {{ end }}
      </tbody>
    </table>

    <h4>Alert Details</h4>
    {{ range .Alerts.Firing }}
    <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd;">
      <p><strong>{{ .Labels.alertname }}</strong></p>
      {{ if .Annotations.description }}
      <p>{{ .Annotations.description }}</p>
      {{ end }}
      {{ if .Labels.endpoint }}<p><strong>Endpoint:</strong> {{ .Labels.endpoint }}</p>{{ end }}
      {{ if .Labels.instance }}<p><strong>Instance:</strong> {{ .Labels.instance }}</p>{{ end }}
      {{ if .Labels.path }}<p><strong>Path:</strong> {{ .Labels.path }}</p>{{ end }}
      <p><strong>For:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05" }}</p>
    </div>
    {{ end }}
  </div>
  {{ end }}

  {{ if .Alerts.Resolved }}
  <div class="alert-body">
    <h3>Resolved Alerts ({{ len .Alerts.Resolved }})</h3>
    <table>
      <thead>
        <tr>
          <th>Alert Name</th>
          <th>Resolved At</th>
          <th>Duration</th>
        </tr>
      </thead>
      <tbody>
        {{ range .Alerts.Resolved }}
        <tr>
          <td><strong>{{ .Labels.alertname }}</strong></td>
          <td>{{ .EndsAt.Format "2006-01-02 15:04:05" }}</td>
          <td>{{ .StartsAt.Sub .EndsAt }}</td>
        </tr>
        {{ end }}
      </tbody>
    </table>
  </div>
  {{ end }}

  <div class="footer">
    <p><strong>Service:</strong> CareDroid Backend</p>
    <p><strong>Environment:</strong> {{ getenv "NODE_ENV" "development" }}</p>
    <p><strong>Alerting System:</strong> Prometheus + Alertmanager</p>
    <p>
      <a href="http://prometheus:9090/alerts">View in Prometheus</a> | 
      <a href="http://grafana:3000">View Grafana Dashboards</a>
    </p>
  </div>
</body>
</html>
{{- end }}

{{ define "pagerduty.default.instances" -}}
{{ range .Alerts.Firing -}}
{{ .Labels.alertname }}
{{ if .Annotations.summary }}: {{ .Annotations.summary }}{{ end }}
{{ end }}
{{- end }}
